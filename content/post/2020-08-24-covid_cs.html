---
title: Nombre de cas de covid dans les commissions scolaires
author: simon
date: '2020-08-24'
slug: covid_cs
categories: []
tags: []
keywords:
  - tech
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<p>This is a quick blog post to try and figure out which school boards are the “hottest zones” for covid.</p>
<p>In this blog post, I will do the following:
- get the shapefiles for both the school boards (commission scolaires, or CS) and the smallest possible health districts (réseau local de santé, or RLS)
- find the intersection between school boards and RLS using sf::st_intersection()
- find the population of each intersection using cancensus::get_census() and tongfen::tongfen_estimate()
- assign the number of cases in each health district (RLS) to each intersection proportionnaly to the population using tongfen::proportional_reaggregate()
- sum the number of cases for each school board (commissions scolaires).</p>
<p>This post is massively dependent on Jens von Bergmann (<span class="citation">@vb_jens</span>) who created both the {cancensus} and the {tongfen} packages and also helped me getting started with tongfen. Thanks Jens!</p>
<p>First, download the number of covid cases at the RLS level from Claude Boucher’s google spreadsheet (and process data from my cronjob)</p>
<pre class="r"><code>## claude data 
url_rls &lt;- &quot;https://docs.google.com/spreadsheets/d/17eJ05pg6fkzKlwwiWn0ztdMvzBX9pGx3q6w7h3_vJw4/&quot;
gs4_deauth()
prout &lt;- read_sheet(url_rls)

rls_population &lt;- prout %&gt;% select(RLS, Population) %&gt;% filter(RLS != &quot;Total&quot;) 

rls_claude  &lt;- prout[1:which(prout$NoRLS == 1801), ] %&gt;% 
  filter(!is.na(NoRLS)) %&gt;% 
  select(-No,  -NoRLS,  -Population)%&gt;% 
  gather(key=key, value=cumulative_cases, -RLS, -RSS) %&gt;%
  mutate_at( vars(cumulative_cases) , as.numeric) %&gt;% 
  filter(!is.na(cumulative_cases)) %&gt;%
  #filter(NoRLS == &quot;0112&quot;) %&gt;%
  mutate(cumulative_cases = map_int(cumulative_cases, ~ as.integer(str_replace_all(.x, &quot; &quot;, &quot;&quot;)))) %&gt;% # remove spaces from numbers
  mutate(date_report = lubridate::ymd(key)) %&gt;% 
  select(-key) %&gt;%
  filter(!is.na(cumulative_cases))

# cronjo data


prepare_cronjob_data &lt;- function(mypath = &quot;~/cronjob/tableau-rls/&quot;){
  pouet &lt;- list.files(
    path =mypath,
    pattern = &quot;.csv$&quot;, 
    full.names = TRUE)
  
  csvs &lt;- purrr::map(pouet, read_csv)
  
  keep &lt;- rep(TRUE, length(csvs))
  for (i in seq(from=2, to = length(csvs))){
    if ( identical(csvs[[i]],csvs[[i-1]])){ 
      keep[i]= FALSE
    }
  }
  dates &lt;- lubridate::ymd(pouet %&gt;% str_sub(start=-19, end = -12))
  
  
  datetimes &lt;- lubridate::ymd_hms(
    paste0(
      pouet %&gt;% str_sub(
        start=-19, end = -12),pouet %&gt;% 
        str_sub(start=-10, end = -5) ))
  z1&lt;- datetimes[keep]
  z2 &lt;- dates[keep]
  z3 &lt;- csvs[keep]
  
  dates_fixed &lt;- tibble(download_datetime = z1) %&gt;%
    mutate(download_hour = lubridate::hour(download_datetime),
           download_date = lubridate::date(download_datetime),
           report_date = if_else(download_hour &gt;=8, download_date, download_date-1) # au milieu de la nuit tu es le rapport d&#39;hier
    ) %&gt;%
    arrange(desc(download_datetime)) %&gt;%
    mutate(report_date_lag = lag(report_date),
           #si j&#39;ai deux rapports différents dans la même journée, le premier est celui de la veille
           report_date_fixed = if_else(report_date == report_date_lag, report_date-1, report_date, report_date))  %&gt;%
    arrange(download_datetime)
  
  gaa &lt;- purrr::map2(z3, z1,
                     ~ .x %&gt;% mutate(download_datetime = .y) )
  gaaa &lt;- purrr::map2(gaa, dates_fixed$report_date_fixed,
                      ~ .x %&gt;% mutate(date_report = .y) )
  
  rls_data &lt;- gaaa %&gt;%
    bind_rows() %&gt;%
    rename(cumulative_cases = Cas) 
  
}

myrls &lt;- prepare_cronjob_data() %&gt;% 
  filter(!is.na(NoRLS), RLS != &quot;Total&quot;) %&gt;%
  mutate(
    cumulative_cases = if_else(cumulative_cases != &quot;n.d.&quot;, cumulative_cases, NA_character_),
    cumulative_cases = as.numeric(str_replace_all(cumulative_cases, &quot;\\s+&quot;, &quot;&quot;)),
    Taux = if_else(Taux != &quot;n.d.&quot;, Taux, NA_character_)
  ) %&gt;%
  select(-No, -NoRLS, -Population, -Taux, -download_datetime) %&gt;%
  filter(!is.na(cumulative_cases))


# combine both sources, fill in the blanks

both &lt;- bind_rows(
  rls_claude %&gt;% 
    mutate(source = &quot;bouchecl&quot;) %&gt;% 
    filter(!(date_report %in% unique(myrls$date_report))) ,
  myrls %&gt;% 
    mutate(source = &quot;cronjob&quot;) 
)


rls &lt;- both %&gt;% 
  group_by(RSS,RLS) %&gt;% 
  arrange( RSS,RLS, desc(date_report)) %&gt;% ## descending date to fix cumulative 
  mutate(fix_cummin = cummin(replace_na(cumulative_cases, Inf))) %&gt;% 
  mutate(cumulative_cases = if_else(cumulative_cases &gt; fix_cummin, fix_cummin, cumulative_cases, cumulative_cases)) %&gt;% ## cumulative can&#39;t be bigger than next day.. if so reduce to next day level.
  arrange( RSS,RLS, date_report) %&gt;% 
  mutate(slope = (lead(cumulative_cases)- cumulative_cases) / as.numeric(lead(date_report) - date_report))  %&gt;%
  complete(date_report = seq.Date(min(date_report), max(date_report), by = &quot;day&quot;)) %&gt;%
  fill(slope, .direction= &quot;down&quot;) %&gt;%  
  mutate(cumulative_cases = if_else(!is.na(cumulative_cases), cumulative_cases, floor(first(cumulative_cases) + cumsum(slope) - slope))    ) %&gt;%   
  select(-slope) %&gt;%
  mutate(cases = cumulative_cases - lag(cumulative_cases)) %&gt;% 
  ungroup() %&gt;%
  filter(!is.na(cases))%&gt;%
  mutate(shortname_rls = str_replace(str_extract(str_replace(RLS, &quot;RLS de &quot;,&quot;RLS &quot; ),&quot;RLS.+&quot;),&quot;RLS &quot;, &quot;&quot;)) %&gt;%
  left_join(rls_population) %&gt;%
  group_by(RSS, RLS) %&gt;%
  mutate(cases_per_100k = cases * 1e5 / Population,
         cases_last_7_days = (cumulative_cases - lag(cumulative_cases,7)),
         cases_last_7_days_per_100k = cases_last_7_days * 1e5 / Population,
         RLS_code = str_extract(RLS, &quot;^\\d+&quot;)
  )%&gt;%
  ungroup()




prep_data &lt;- function(data, group, type){
  
  type_column &lt;- enquo(type)   ## this has to be !!
  type_name &lt;- quo_name(type_column) ## its a string, dont !!
  mean_name = paste0(&quot;avg_&quot;, type_name, &quot;_last7&quot;)   
  mean_column &lt;- sym(mean_name)
  gaa &lt;-   data %&gt;% 
    group_by( {{ group }} ) %&gt;%
    arrange(date_report) %&gt;% 
    mutate(!!mean_name := ( !!type_column + lag(!!type_column, 1) + lag(!!type_column, 2) + lag(!!type_column, 3) + lag(!!type_column, 4) + lag(!!type_column, 5) + lag(!!type_column, 6)) / 7)  %&gt;%
    ungroup() 
  
  gaa1 &lt;- gaa %&gt;%
    group_by( {{ group }}) %&gt;%
    summarise(total = sum(!!type_column),
              worst7 = max(!!mean_column, na.rm = TRUE),
              last7  = max(!!mean_column * (date_report == max(date_report)), na.rm = TRUE),
              ratio = last7 / worst7,
              winning = factor( 
                case_when(ratio &lt; 0.33 ~ &quot;Winning&quot;,
                          ratio &lt; 0.67 ~ &quot;Nearly there&quot;,
                          TRUE ~ &quot;Needs action&quot;
                )
                , levels = c(&quot;Winning&quot;, &quot;Nearly there&quot;, &quot;Needs action&quot;))
    ) %&gt;%
    ungroup() %&gt;%
    
    mutate(
      group = fct_reorder( {{ group }}, total, .desc =TRUE)
    )
  
  gaa %&gt;% 
    left_join(gaa1) 
  
}

rls_cases &lt;- prep_data(rls, shortname_rls, type = cases)
firstdate &lt;- min(rls_cases$date_report)
lastdate  &lt;- max(rls_cases$date_report)</code></pre>
<p>We want to assign the covid cases from these “RLS” (health districts)</p>
<pre class="r"><code>rls_shp &lt;- read_sf(here::here(&quot;content/post/data/downloads/Territoires_RLS_2020.shp&quot;)) %&gt;%
  st_transform(crs=4326) %&gt;%
  rmapshaper::ms_simplify() %&gt;%
  left_join(rls %&gt;% filter(date_report ==max(date_report)) %&gt;% select(date_report, RLS_code, cases_last_7_days_per_100k, cumulative_cases, cases_last_7_days, Population )) %&gt;%
  mutate(dailycases_per_1M_avg_7_days = round(cases_last_7_days * 1e6 /7 / Population,1))

ggplot(data = rls_shp )+
  geom_sf(aes(fill=dailycases_per_1M_avg_7_days))+
  labs(title = paste0(&quot;There are &quot;, nrow(rls_shp), &quot; RLS&quot;))</code></pre>
<p><img src="/post/2020-08-24-covid_cs_files/figure-html/unnamed-chunk-3-1.png" width="1152" style="display: block; margin: auto;" /></p>
<pre class="r"><code>rls_shp %&gt;% arrange(desc(dailycases_per_1M_avg_7_days)) %&gt;%  
  mutate(rang = row_number())%&gt;%
  select(rang, RLS_nom, dailycases_per_1M_avg_7_days, cases_last_7_days, Population) %&gt;% 
  st_drop_geometry %&gt;%
  kable(
    caption  = paste0(&quot;Nombre moyen de nouveaux cas de covid19 par million d&#39;habitants \n pour les 7 derniers jours pour les RLS en date du  &quot;, lastdate),
    col.names = c(&quot;Rang&quot;, &quot;Nom RLS&quot;, &quot;Nombre moyen de cas par million dans les 7 derniers jours&quot;, &quot;Nombre de nouveaux cas dans les 7 derniers jours&quot;, &quot;Population 2016&quot;)
  ) %&gt;% 
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;), full_width = FALSE, position = &quot;center&quot;) %&gt;% 
  row_spec(0, background = &quot;#555555&quot;, color = &quot;#fff&quot;)</code></pre>
<table class="table table-striped table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-4">Table 1: </span>Nombre moyen de nouveaux cas de covid19 par million d’habitants
pour les 7 derniers jours pour les RLS en date du 2020-08-10
</caption>
<thead>
<tr>
<th style="text-align:right;color: #fff !important;background-color: #555555 !important;">
Rang
</th>
<th style="text-align:left;color: #fff !important;background-color: #555555 !important;">
Nom RLS
</th>
<th style="text-align:right;color: #fff !important;background-color: #555555 !important;">
Nombre moyen de cas par million dans les 7 derniers jours
</th>
<th style="text-align:right;color: #fff !important;background-color: #555555 !important;">
Nombre de nouveaux cas dans les 7 derniers jours
</th>
<th style="text-align:right;color: #fff !important;background-color: #555555 !important;">
Population 2016
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
RLS de Deux-Montagnes - Mirabel-Sud
</td>
<td style="text-align:right;">
50.4
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
124641
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
RLS du Haut-Saint-François
</td>
<td style="text-align:right;">
44.0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
22749
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
RLS de la Haute-Gaspésie
</td>
<td style="text-align:right;">
40.5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10582
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
RLS des Faubourgs - Plateau-Mont-Royal - St-Louis-du-Parc
</td>
<td style="text-align:right;">
38.1
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
161317
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
RLS des Etchemins
</td>
<td style="text-align:right;">
34.8
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
16426
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
RLS de la Petite Patrie - Villeray
</td>
<td style="text-align:right;">
34.6
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
115485
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
RLS de Hochelaga - Mercier-Ouest - Rosemont
</td>
<td style="text-align:right;">
31.0
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
189095
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
RLS de Saint-Léonard - Saint-Michel
</td>
<td style="text-align:right;">
28.7
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
139162
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
RLS du Suroît
</td>
<td style="text-align:right;">
28.3
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
60523
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
RLS d’Ahuntsic - Montréal-Nord
</td>
<td style="text-align:right;">
27.3
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
172517
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
RLS de Verdun - Côte St-Paul - St-Henri - Pointe-St-Charles
</td>
<td style="text-align:right;">
25.8
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
166225
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
RLS de Dorval - Lachine - Lasalle
</td>
<td style="text-align:right;">
23.9
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
149522
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
RLS de Côte-Saint-Luc - NDG - Montréal-Ouest
</td>
<td style="text-align:right;">
23.9
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
131424
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
RLS de Lanaudière-Sud
</td>
<td style="text-align:right;">
23.1
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
296993
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
RLS du Nord de l’Île - Saint-Laurent
</td>
<td style="text-align:right;">
22.9
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
161894
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
RLS de Laval
</td>
<td style="text-align:right;">
22.9
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
442745
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
RLS Pierre-Boucher
</td>
<td style="text-align:right;">
22.9
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
262440
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
RLS de Côte-des-Neiges - Métro - Parc-Extension
</td>
<td style="text-align:right;">
22.7
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
245703
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
RLS de Richelieu-Yamaska
</td>
<td style="text-align:right;">
22.6
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
220957
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
RLS de la Rivière-du-Nord - Mirabel-Nord
</td>
<td style="text-align:right;">
21.7
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
177517
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
RLS de Champlain
</td>
<td style="text-align:right;">
21.5
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
225442
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:left;">
RLS de Lanaudière-Nord
</td>
<td style="text-align:right;">
20.5
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
223099
</td>
</tr>
<tr>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
RLS de Vaudreuil-Soulanges
</td>
<td style="text-align:right;">
19.6
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
160002
</td>
</tr>
<tr>
<td style="text-align:right;">
24
</td>
<td style="text-align:left;">
RLS de Thérèse-De Blainville
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
163430
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
RLS de la Pommeraie
</td>
<td style="text-align:right;">
17.8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
56125
</td>
</tr>
<tr>
<td style="text-align:right;">
26
</td>
<td style="text-align:left;">
RLS de Jardins-Roussillon
</td>
<td style="text-align:right;">
17.2
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
232373
</td>
</tr>
<tr>
<td style="text-align:right;">
27
</td>
<td style="text-align:left;">
RLS d’Argenteuil
</td>
<td style="text-align:right;">
17.1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
33422
</td>
</tr>
<tr>
<td style="text-align:right;">
28
</td>
<td style="text-align:left;">
RLS de La Côte-de-Gaspé
</td>
<td style="text-align:right;">
15.2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
18753
</td>
</tr>
<tr>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
RLS du Haut-Richelieu - Rouville
</td>
<td style="text-align:right;">
14.6
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
195297
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
RLS de la Haute-Yamaska
</td>
<td style="text-align:right;">
13.5
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
105861
</td>
</tr>
<tr>
<td style="text-align:right;">
31
</td>
<td style="text-align:left;">
RLS de Grande-Rivière - Hull - Gatineau
</td>
<td style="text-align:right;">
13.5
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
264517
</td>
</tr>
<tr>
<td style="text-align:right;">
32
</td>
<td style="text-align:left;">
RLS des Pays-d’en-Haut
</td>
<td style="text-align:right;">
12.9
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
44362
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
RLS de Rivière-des-Prairies - Anjou - Montréal-Est
</td>
<td style="text-align:right;">
12.3
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
208717
</td>
</tr>
<tr>
<td style="text-align:right;">
34
</td>
<td style="text-align:left;">
RLS des Îles-de-la-Madeleine
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12606
</td>
</tr>
<tr>
<td style="text-align:right;">
35
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
<td style="text-align:right;">
10.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13558
</td>
</tr>
<tr>
<td style="text-align:right;">
36
</td>
<td style="text-align:left;">
RLS de Pierrefonds - Lac Saint-Louis
</td>
<td style="text-align:right;">
10.2
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
224596
</td>
</tr>
<tr>
<td style="text-align:right;">
37
</td>
<td style="text-align:left;">
RLS de la région de Thetford
</td>
<td style="text-align:right;">
10.1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
42500
</td>
</tr>
<tr>
<td style="text-align:right;">
38
</td>
<td style="text-align:left;">
RLS d’Asbestos
</td>
<td style="text-align:right;">
10.0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14257
</td>
</tr>
<tr>
<td style="text-align:right;">
39
</td>
<td style="text-align:left;">
RLS de la Vallée-de-la-Lièvre et de la Petite-Nation
</td>
<td style="text-align:right;">
10.0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
56920
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
RLS de la Baie-des-Chaleurs
</td>
<td style="text-align:right;">
8.9
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
32176
</td>
</tr>
<tr>
<td style="text-align:right;">
41
</td>
<td style="text-align:left;">
RLS Pierre-De Saurel
</td>
<td style="text-align:right;">
8.3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
51371
</td>
</tr>
<tr>
<td style="text-align:right;">
42
</td>
<td style="text-align:left;">
RLS d’Antoine-Labelle
</td>
<td style="text-align:right;">
8.0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
35580
</td>
</tr>
<tr>
<td style="text-align:right;">
43
</td>
<td style="text-align:left;">
RLS de Beauce
</td>
<td style="text-align:right;">
7.8
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
73173
</td>
</tr>
<tr>
<td style="text-align:right;">
44
</td>
<td style="text-align:left;">
Terres-Cries-de-la-Baie-James
</td>
<td style="text-align:right;">
7.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
18385
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:left;">
RLS de Coaticook
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
18741
</td>
</tr>
<tr>
<td style="text-align:right;">
46
</td>
<td style="text-align:left;">
RLS de Sherbrooke
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
170075
</td>
</tr>
<tr>
<td style="text-align:right;">
47
</td>
<td style="text-align:left;">
RLS de l’Abitibi-Ouest
</td>
<td style="text-align:right;">
7.0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
20528
</td>
</tr>
<tr>
<td style="text-align:right;">
48
</td>
<td style="text-align:left;">
RLS de Kamouraska
</td>
<td style="text-align:right;">
6.9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
20780
</td>
</tr>
<tr>
<td style="text-align:right;">
49
</td>
<td style="text-align:left;">
RLS du Granit
</td>
<td style="text-align:right;">
6.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
21351
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:left;">
RLS de Rouyn-Noranda
</td>
<td style="text-align:right;">
6.6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
43180
</td>
</tr>
<tr>
<td style="text-align:right;">
51
</td>
<td style="text-align:left;">
RLS de Maskinongé
</td>
<td style="text-align:right;">
6.2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22961
</td>
</tr>
<tr>
<td style="text-align:right;">
52
</td>
<td style="text-align:left;">
RLS de Québec-Sud
</td>
<td style="text-align:right;">
5.8
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
321016
</td>
</tr>
<tr>
<td style="text-align:right;">
53
</td>
<td style="text-align:left;">
RLS de la Vallée-de-la-Batiscan
</td>
<td style="text-align:right;">
5.6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
25562
</td>
</tr>
<tr>
<td style="text-align:right;">
54
</td>
<td style="text-align:left;">
RLS de Rivière-du-Loup
</td>
<td style="text-align:right;">
4.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
34800
</td>
</tr>
<tr>
<td style="text-align:right;">
55
</td>
<td style="text-align:left;">
RLS Alphonse-Desjardins
</td>
<td style="text-align:right;">
3.9
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
258118
</td>
</tr>
<tr>
<td style="text-align:right;">
56
</td>
<td style="text-align:left;">
RLS des Collines-de-l’Outaouais
</td>
<td style="text-align:right;">
3.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
38891
</td>
</tr>
<tr>
<td style="text-align:right;">
57
</td>
<td style="text-align:left;">
RLS de Québec-Nord
</td>
<td style="text-align:right;">
3.3
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
351429
</td>
</tr>
<tr>
<td style="text-align:right;">
58
</td>
<td style="text-align:left;">
RLS de la Vallée-de-l’Or
</td>
<td style="text-align:right;">
3.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
43551
</td>
</tr>
<tr>
<td style="text-align:right;">
59
</td>
<td style="text-align:left;">
RLS de Bécancour–Nicolet-Yamaska
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
44619
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:left;">
RLS des Laurentides
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
48016
</td>
</tr>
<tr>
<td style="text-align:right;">
61
</td>
<td style="text-align:left;">
RLS d’Arthabaska-et-de-L’Érable
</td>
<td style="text-align:right;">
2.9
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
98244
</td>
</tr>
<tr>
<td style="text-align:right;">
62
</td>
<td style="text-align:left;">
RLS de Lac-Saint-Jean-Est
</td>
<td style="text-align:right;">
2.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
52298
</td>
</tr>
<tr>
<td style="text-align:right;">
63
</td>
<td style="text-align:left;">
RLS de Memphrémagog
</td>
<td style="text-align:right;">
2.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
52514
</td>
</tr>
<tr>
<td style="text-align:right;">
64
</td>
<td style="text-align:left;">
RLS de Portneuf
</td>
<td style="text-align:right;">
2.6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
54895
</td>
</tr>
<tr>
<td style="text-align:right;">
65
</td>
<td style="text-align:left;">
RLS de Rimouski
</td>
<td style="text-align:right;">
2.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
57630
</td>
</tr>
<tr>
<td style="text-align:right;">
66
</td>
<td style="text-align:left;">
RLS du Centre-de-la-Mauricie
</td>
<td style="text-align:right;">
2.2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
64641
</td>
</tr>
<tr>
<td style="text-align:right;">
67
</td>
<td style="text-align:left;">
RLS de Jonquière
</td>
<td style="text-align:right;">
2.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
67417
</td>
</tr>
<tr>
<td style="text-align:right;">
68
</td>
<td style="text-align:left;">
RLS de Chicoutimi
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
79201
</td>
</tr>
<tr>
<td style="text-align:right;">
69
</td>
<td style="text-align:left;">
RLS de Drummond
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
107872
</td>
</tr>
<tr>
<td style="text-align:right;">
70
</td>
<td style="text-align:left;">
RLS de Trois-Rivières
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
143422
</td>
</tr>
<tr>
<td style="text-align:right;">
71
</td>
<td style="text-align:left;">
RLS de Témiscouata
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
19117
</td>
</tr>
<tr>
<td style="text-align:right;">
72
</td>
<td style="text-align:left;">
RLS de Matane
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
20726
</td>
</tr>
<tr>
<td style="text-align:right;">
73
</td>
<td style="text-align:left;">
RLS du Domaine-du-Roy
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
31078
</td>
</tr>
<tr>
<td style="text-align:right;">
74
</td>
<td style="text-align:left;">
RLS de Maria-Chapdelaine
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
25064
</td>
</tr>
<tr>
<td style="text-align:right;">
75
</td>
<td style="text-align:left;">
RLS de La Baie
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
22574
</td>
</tr>
<tr>
<td style="text-align:right;">
76
</td>
<td style="text-align:left;">
RLS de Charlevoix
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
28119
</td>
</tr>
<tr>
<td style="text-align:right;">
77
</td>
<td style="text-align:left;">
RLS de Val Saint-François
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
31490
</td>
</tr>
<tr>
<td style="text-align:right;">
78
</td>
<td style="text-align:left;">
RLS de la Vallée-de-la-Gatineau
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
20552
</td>
</tr>
<tr>
<td style="text-align:right;">
79
</td>
<td style="text-align:left;">
RLS de l’Abitibi
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
24729
</td>
</tr>
<tr>
<td style="text-align:right;">
80
</td>
<td style="text-align:left;">
RLS du Témiscaming
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
15628
</td>
</tr>
<tr>
<td style="text-align:right;">
81
</td>
<td style="text-align:left;">
RLS de Caniapiscau
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3230
</td>
</tr>
<tr>
<td style="text-align:right;">
82
</td>
<td style="text-align:left;">
RLS de la Haute-Côte-Nord - Manicouagan
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
40494
</td>
</tr>
<tr>
<td style="text-align:right;">
83
</td>
<td style="text-align:left;">
RLS de Port-Cartier
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7314
</td>
</tr>
<tr>
<td style="text-align:right;">
84
</td>
<td style="text-align:left;">
RLS de Sept-Îles
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
27344
</td>
</tr>
<tr>
<td style="text-align:right;">
85
</td>
<td style="text-align:left;">
RLS de la Minganie
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6428
</td>
</tr>
<tr>
<td style="text-align:right;">
86
</td>
<td style="text-align:left;">
RLS de la Basse-Côte-Nord
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4582
</td>
</tr>
<tr>
<td style="text-align:right;">
87
</td>
<td style="text-align:left;">
RLS de Kawawachikamach
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
641
</td>
</tr>
<tr>
<td style="text-align:right;">
88
</td>
<td style="text-align:left;">
RLS du Rocher-Percé
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
15881
</td>
</tr>
<tr>
<td style="text-align:right;">
89
</td>
<td style="text-align:left;">
RLS de Montmagny-L’Islet
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
40092
</td>
</tr>
<tr>
<td style="text-align:right;">
90
</td>
<td style="text-align:left;">
RLS du Haut-Saint-Laurent
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
24346
</td>
</tr>
<tr>
<td style="text-align:right;">
91
</td>
<td style="text-align:left;">
Nunavik
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
14260
</td>
</tr>
<tr>
<td style="text-align:right;">
92
</td>
<td style="text-align:left;">
RLS des Basques
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
93
</td>
<td style="text-align:left;">
RLS de La Mitis
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
94
</td>
<td style="text-align:left;">
RLS de La Matapédia
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
95
</td>
<td style="text-align:left;">
RLS du Haut-Saint-Maurice
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
96
</td>
<td style="text-align:left;">
RLS du Pontiac
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p>To these “commission scolaires”.</p>
<pre class="r"><code>CS_FRA_SDA &lt;- read_sf(here::here(&quot;content/post/data/downloads/CS&quot;, &quot;CS_FRA_SDA.shp&quot;))%&gt;%
  rmapshaper::ms_simplify()

ggplot(data = CS_FRA_SDA) +
  geom_sf()+
  labs(title = paste0(&quot;There are &quot;, nrow(CS_FRA_SDA), &quot; commissions scolaires&quot;))</code></pre>
<p><img src="/post/2020-08-24-covid_cs_files/figure-html/unnamed-chunk-5-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>First, we create the smallest common denominators (intersections) between the two geographies using sf::st_intersection() and st_collection_extract()</p>
<pre class="r"><code>intersections &lt;- st_intersection(
  rls_shp %&gt;% select(RLS_code),  ## RLS = région locale de service = health region,   RLS_code = health region id
  CS_FRA_SDA %&gt;% select(CD_CS, NOM_CS)) %&gt;%  ## CS = school board, CD_CS = school board id
  st_collection_extract(type=&quot;POLYGON&quot;) ## drop polylines

ggplot(data = intersections) +
  geom_sf()+
  labs(title = paste0(&quot;There are &quot;, nrow(intersections), &quot; intersections&quot;))</code></pre>
<p><img src="/post/2020-08-24-covid_cs_files/figure-html/unnamed-chunk-6-1.png" width="1152" style="display: block; margin: auto;" />
Then, we will allocate the cases at the RLS to the lower geography level “intersections” proportionnally to the population of the intersections.</p>
<p>To do this, we must find the population of each intersection.<br />
First, we download census population and shapefile using cancensus::get_census()
Table below shows the population for a sample of the dissemination areas (DA)</p>
<pre class="r"><code>census_data_da &lt;- get_census(dataset=&#39;CA16&#39;, regions=list(PR=&quot;24&quot;), vectors=c(&quot;pop2016&quot;= &quot;v_CA16_401&quot;), level=&#39;DA&#39;,geo_format=&quot;sf&quot;) 

head(census_data_da %&gt;% st_drop_geometry)</code></pre>
<pre><code>##   Shape Area Type Households CD_UID Dwellings   GeoUID Population CSD_UID
## 1   40.78502   DA        213   2401       254 24010018        465 2401042
## 2    7.91099   DA        230   2401       261 24010019        496 2401023
## 3   33.38888   DA        224   2401       248 24010020        523 2401023
## 4    2.94327   DA        212   2401       235 24010021        524 2401023
## 5    3.98348   DA        251   2401       285 24010022        530 2401023
## 6    5.70935   DA        251   2401       301 24010023        542 2401023
##   CMA_UID CT_UID              Region Name Area (sq km) pop2016
## 1    &lt;NA&gt;   &lt;NA&gt;               Grosse-Île     40.78502     465
## 2    &lt;NA&gt;   &lt;NA&gt; Les Îles-de-la-Madeleine      7.91099     496
## 3    &lt;NA&gt;   &lt;NA&gt; Les Îles-de-la-Madeleine     33.38888     523
## 4    &lt;NA&gt;   &lt;NA&gt; Les Îles-de-la-Madeleine      2.94327     524
## 5    &lt;NA&gt;   &lt;NA&gt; Les Îles-de-la-Madeleine      3.98348     530
## 6    &lt;NA&gt;   &lt;NA&gt; Les Îles-de-la-Madeleine      5.70935     542</code></pre>
<p>Then we estimate the population of the “intersections” using tongfen::tongfen_estimate(). The estimates are “perfect” if the borders of the intersections line up with statcan’s “dissemination area”. When they dont, the
population of a dissemination area is spread proportionally to the area covered by each intersection.</p>
<p>Table below shows the population for a sample of the intersections</p>
<pre class="r"><code>intersections_populations &lt;- tongfen_estimate(
  intersections,
  census_data_da,
  meta_for_additive_variables(&quot;census_data_da&quot;, &quot;Population&quot;)
)

head(intersections_populations)</code></pre>
<pre><code>## Simple feature collection with 6 features and 4 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -72.09877 ymin: 45.00646 xmax: -71.39747 ymax: 45.7684
## geographic CRS: WGS 84
##     Population RLS_code  CD_CS                NOM_CS
## 1 1.501631e+01     0513 751000 CSS des Hauts-Cantons
## 2 3.087784e-01     0513 751000 CSS des Hauts-Cantons
## 3 2.717933e-01     0513 751000 CSS des Hauts-Cantons
## 4 1.667248e+04     0514 751000 CSS des Hauts-Cantons
## 5 1.741468e-01     0516 751000 CSS des Hauts-Cantons
## 6 1.966473e-02     0517 751000 CSS des Hauts-Cantons
##                         geometry
## 1 MULTIPOLYGON (((-71.90947 4...
## 2 MULTIPOLYGON (((-71.92083 4...
## 3 MULTIPOLYGON (((-71.91972 4...
## 4 MULTIPOLYGON (((-71.81586 4...
## 5 MULTIPOLYGON (((-71.71563 4...
## 6 MULTIPOLYGON (((-71.47856 4...</code></pre>
<p>Assign the health districts covid cases to the lower geography level (intersections) using proportional_reaggregate(). This is population-weighted.
Then, sum the number of cases and population in each intersection to get the number of cases and population at the school board (Commission scolaire) level.</p>
<p>The end result is this map and table:</p>
<pre class="r"><code>cases_intersections &lt;- tongfen::proportional_reaggregate(
  data = intersections_populations,
  parent_data = rls_shp ,
  geo_match = c(&quot;RLS_code&quot; = &quot;RLS_code&quot;),
  categories = c(&quot;cases_last_7_days&quot;),
  base = &quot;Population&quot;
)


cases_cs &lt;- cases_intersections %&gt;% 
  group_by(CD_CS, NOM_CS) %&gt;% 
  summarise(
    cases_last_7_days = sum(cases_last_7_days, na.rm = TRUE),
    Population = sum(Population, na.rm = TRUE),
    
  ) %&gt;%
  ungroup() %&gt;%
  mutate(
    dailycases_per_1M_avg_7_days = round(cases_last_7_days * 1e6 /7 / Population,1),
    
    cases_last_7_days_per_100k = round(cases_last_7_days * 100000 / Population,1),
    cases_last_7_days = round(cases_last_7_days),
    Population = round(Population)
    
  )

ggplot(data = cases_cs) +
  geom_sf(aes(fill=dailycases_per_1M_avg_7_days))+ 
  #scale_fill_viridis_c() + 
  scale_fill_gradient(
    
    low = &quot;white&quot;,
    high = &quot;red&quot;,
    space = &quot;Lab&quot;,
    na.value = &quot;grey50&quot;,
    guide = &quot;colourbar&quot;,
    aesthetics = &quot;fill&quot;
  ) + 
  labs(title = paste0(&quot;Nombre moyen de nouveaux cas de covid19 par million d&#39;habitants pour les 7 derniers jours pour les commissions scolaires&quot;),
       fill = &quot;Cas par 1M habitants&quot;,
       caption = paste0(&quot;En date du &quot; , format(lastdate, format=&quot;%B %d %Y&quot;), &quot;. Les données sont publiées au niveau des RLS (réseau local de service) et distribuées aux CSS proportionnellement à la population lorsque le RLS couvre plus d&#39;une CSS&quot;)
  )+
  theme_bw() +
  theme(panel.grid.major = element_line(colour = &quot;transparent&quot;))</code></pre>
<p><img src="/post/2020-08-24-covid_cs_files/figure-html/unnamed-chunk-9-1.png" width="1344" style="display: block; margin: auto;" /></p>
<pre class="r"><code>cases_cs %&gt;% 
  ungroup %&gt;% 
  st_drop_geometry() %&gt;%
  arrange(-dailycases_per_1M_avg_7_days) %&gt;%
  mutate(rang = row_number())%&gt;%
  select(rang, NOM_CS, dailycases_per_1M_avg_7_days, cases_last_7_days, Population) %&gt;% 
  kable(
    caption  = paste0(&quot;Nombre moyen de nouveaux cas de covid19 par million d&#39;habitants \n pour les 7 derniers jours pour les commissions scolaires en date du  &quot;, lastdate),
    col.names = c(&quot;Rang&quot;, &quot;Nom Commission Scolaire&quot;, &quot;Nombre moyen de cas par million dans les 7 derniers jours&quot;, &quot;Nombre de nouveaux cas dans les 7 derniers jours&quot;, &quot;Population 2016&quot;)) %&gt;% 
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;), full_width = FALSE, position = &quot;center&quot;) %&gt;% 
  row_spec(0, background = &quot;#555555&quot;, color = &quot;#fff&quot;)</code></pre>
<table class="table table-striped table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-10">Table 2: </span>Nombre moyen de nouveaux cas de covid19 par million d’habitants
pour les 7 derniers jours pour les commissions scolaires en date du 2020-08-10
</caption>
<thead>
<tr>
<th style="text-align:right;color: #fff !important;background-color: #555555 !important;">
Rang
</th>
<th style="text-align:left;color: #fff !important;background-color: #555555 !important;">
Nom Commission Scolaire
</th>
<th style="text-align:right;color: #fff !important;background-color: #555555 !important;">
Nombre moyen de cas par million dans les 7 derniers jours
</th>
<th style="text-align:right;color: #fff !important;background-color: #555555 !important;">
Nombre de nouveaux cas dans les 7 derniers jours
</th>
<th style="text-align:right;color: #fff !important;background-color: #555555 !important;">
Population 2016
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
CSS de la Seigneurie-des-Mille-Îles
</td>
<td style="text-align:right;">
33.3
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
291498
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
CSS de Montréal
</td>
<td style="text-align:right;">
30.3
</td>
<td style="text-align:right;">
215
</td>
<td style="text-align:right;">
1014236
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
CSS des Chic-Chocs
</td>
<td style="text-align:right;">
24.3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
29447
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
CSS des Affluents
</td>
<td style="text-align:right;">
24.2
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
267561
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
CSS de Laval
</td>
<td style="text-align:right;">
24.0
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
423003
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
CSS de Saint-Hyacinthe
</td>
<td style="text-align:right;">
23.3
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
102679
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
CSS de la Rivière-du-Nord
</td>
<td style="text-align:right;">
23.1
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
190460
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
CSS Marie-Victorin
</td>
<td style="text-align:right;">
23.1
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
347095
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
CSS des Patriotes
</td>
<td style="text-align:right;">
22.3
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
270108
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
CSS des Samares
</td>
<td style="text-align:right;">
21.6
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
207792
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
CSS de la Vallée-des-Tisserands
</td>
<td style="text-align:right;">
21.3
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
86777
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
CSS de la Pointe-de-l’Île
</td>
<td style="text-align:right;">
21.2
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
316733
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
CSS des Trois-Lacs
</td>
<td style="text-align:right;">
21.0
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
149319
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
CSS Marguerite-Bourgeoys
</td>
<td style="text-align:right;">
20.3
</td>
<td style="text-align:right;">
87
</td>
<td style="text-align:right;">
610999
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
CSS des Hauts-Cantons
</td>
<td style="text-align:right;">
19.6
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
51887
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
CSS des Grandes-Seigneuries
</td>
<td style="text-align:right;">
19.4
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
197898
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
CSS de la Baie-James
</td>
<td style="text-align:right;">
17.7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
16177
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
CSS du Val-des-Cerfs
</td>
<td style="text-align:right;">
15.8
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
146620
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
CSS des Hautes-Rivières
</td>
<td style="text-align:right;">
15.5
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
155632
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
CSS des Portages-de-l’Outaouais
</td>
<td style="text-align:right;">
12.7
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
153452
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
CSS des Draveurs
</td>
<td style="text-align:right;">
12.6
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
140717
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:left;">
CSS des Îles
</td>
<td style="text-align:right;">
11.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12475
</td>
</tr>
<tr>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
CSS au Coeur-des-Vallées
</td>
<td style="text-align:right;">
10.5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
53662
</td>
</tr>
<tr>
<td style="text-align:right;">
24
</td>
<td style="text-align:left;">
CSS de la Beauce-Etchemin
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
123825
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
CSS des Appalaches
</td>
<td style="text-align:right;">
9.9
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
45953
</td>
</tr>
<tr>
<td style="text-align:right;">
26
</td>
<td style="text-align:left;">
CSS des Laurentides
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
92009
</td>
</tr>
<tr>
<td style="text-align:right;">
27
</td>
<td style="text-align:left;">
CSS de la Région-de-Sherbrooke
</td>
<td style="text-align:right;">
8.5
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
179142
</td>
</tr>
<tr>
<td style="text-align:right;">
28
</td>
<td style="text-align:left;">
CSS de Sorel-Tracy
</td>
<td style="text-align:right;">
8.4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50995
</td>
</tr>
<tr>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
CSS Pierre-Neveu
</td>
<td style="text-align:right;">
8.1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
35249
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
CSS du Lac-Abitibi
</td>
<td style="text-align:right;">
7.0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
20533
</td>
</tr>
<tr>
<td style="text-align:right;">
31
</td>
<td style="text-align:left;">
CSS de Rouyn-Noranda
</td>
<td style="text-align:right;">
6.7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
41784
</td>
</tr>
<tr>
<td style="text-align:right;">
32
</td>
<td style="text-align:left;">
CSS des Découvreurs
</td>
<td style="text-align:right;">
6.0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
138839
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:left;">
CSS René-Lévesque
</td>
<td style="text-align:right;">
5.9
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
48363
</td>
</tr>
<tr>
<td style="text-align:right;">
34
</td>
<td style="text-align:left;">
CSS de Kamouraska-Rivière-du-Loup
</td>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
55735
</td>
</tr>
<tr>
<td style="text-align:right;">
35
</td>
<td style="text-align:left;">
CSS de la Capitale
</td>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
278887
</td>
</tr>
<tr>
<td style="text-align:right;">
36
</td>
<td style="text-align:left;">
CSS des Navigateurs
</td>
<td style="text-align:right;">
4.0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
183344
</td>
</tr>
<tr>
<td style="text-align:right;">
37
</td>
<td style="text-align:left;">
CSS des Premières-Seigneuries
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
230723
</td>
</tr>
<tr>
<td style="text-align:right;">
38
</td>
<td style="text-align:left;">
CSS de l’Or-et-des-Bois
</td>
<td style="text-align:right;">
3.4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
43767
</td>
</tr>
<tr>
<td style="text-align:right;">
39
</td>
<td style="text-align:left;">
CSS des Sommets
</td>
<td style="text-align:right;">
3.3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
84188
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
CSS de la Riveraine
</td>
<td style="text-align:right;">
3.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
43263
</td>
</tr>
<tr>
<td style="text-align:right;">
41
</td>
<td style="text-align:left;">
CSS des Bois-Francs
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
94346
</td>
</tr>
<tr>
<td style="text-align:right;">
42
</td>
<td style="text-align:left;">
CSS du Lac-Saint-Jean
</td>
<td style="text-align:right;">
2.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
52082
</td>
</tr>
<tr>
<td style="text-align:right;">
43
</td>
<td style="text-align:left;">
CSS de Portneuf
</td>
<td style="text-align:right;">
2.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
53072
</td>
</tr>
<tr>
<td style="text-align:right;">
44
</td>
<td style="text-align:left;">
CSS de l’Énergie
</td>
<td style="text-align:right;">
2.6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
97132
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
<td style="text-align:left;">
CSS De La Jonquière
</td>
<td style="text-align:right;">
2.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
66717
</td>
</tr>
<tr>
<td style="text-align:right;">
46
</td>
<td style="text-align:left;">
CSS des Phares
</td>
<td style="text-align:right;">
1.9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
74864
</td>
</tr>
<tr>
<td style="text-align:right;">
47
</td>
<td style="text-align:left;">
CSS du Chemin-du-Roy
</td>
<td style="text-align:right;">
1.9
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
168945
</td>
</tr>
<tr>
<td style="text-align:right;">
48
</td>
<td style="text-align:left;">
CSS de la Côte-du-Sud
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
70534
</td>
</tr>
<tr>
<td style="text-align:right;">
49
</td>
<td style="text-align:left;">
CSS des Rives-du-Saguenay
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
100969
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:left;">
CSS des Chênes
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
103398
</td>
</tr>
<tr>
<td style="text-align:right;">
51
</td>
<td style="text-align:left;">
CSS du Fleuve-et-des-Lacs
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
29130
</td>
</tr>
<tr>
<td style="text-align:right;">
52
</td>
<td style="text-align:left;">
CSS des Monts-et-Marées
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
39227
</td>
</tr>
<tr>
<td style="text-align:right;">
53
</td>
<td style="text-align:left;">
CSS du Pays-des-Bleuets
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
56735
</td>
</tr>
<tr>
<td style="text-align:right;">
54
</td>
<td style="text-align:left;">
CSS de Charlevoix
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
28363
</td>
</tr>
<tr>
<td style="text-align:right;">
55
</td>
<td style="text-align:left;">
CSS des Hauts-Bois-de-l’Outaouais
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
33871
</td>
</tr>
<tr>
<td style="text-align:right;">
56
</td>
<td style="text-align:left;">
CSS du Lac-Témiscamingue
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
15948
</td>
</tr>
<tr>
<td style="text-align:right;">
57
</td>
<td style="text-align:left;">
CSS Harricana
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
24652
</td>
</tr>
<tr>
<td style="text-align:right;">
58
</td>
<td style="text-align:left;">
CSS de l’Estuaire
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
41865
</td>
</tr>
<tr>
<td style="text-align:right;">
59
</td>
<td style="text-align:left;">
CSS du Fer
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
39323
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:left;">
CSS de la Moyenne-Côte-Nord
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6424
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>cases_cs %&gt;% 
  arrange(-dailycases_per_1M_avg_7_days)  %&gt;%
  mutate(NOM_CS = as.factor(NOM_CS) )%&gt;%
  ggplot(aes(x= fct_reorder(NOM_CS, dailycases_per_1M_avg_7_days), y= dailycases_per_1M_avg_7_days )) + 
  scale_y_continuous(expand = c(0, 0), limits = c(0, NA))+
  geom_col() +
  geom_hline(yintercept = 20, color = &quot;red&quot;, size =2 ) +
  geom_text(x=1, y=1, hjust=&quot;left&quot;, label= &quot;Selon le critère établi par le ministre Dubé, la courbe est aplatie sous 20 cas / million&quot;)+
  
  coord_flip() +
  
  cowplot::theme_half_open() +
  cowplot::background_grid() +
  colorblindr::scale_color_OkabeIto( ) +
  labs(
    title = &quot;Nombre estimé de cas par 1 million d&#39;habitant au cours des 7 derniers jours&quot;,
    subtitle = paste0(&quot;En date du &quot; , format(lastdate, format=&quot;%B %d %Y&quot;)), 
    caption = paste0(&quot;. Les données sont publiées au niveau des RLS (réseau local de service) et distribuées aux CSS proportionnellement à la population lorsque le RLS couvre plus d&#39;une CSS&quot;),
    x = &quot;Commission scolaire&quot;,
    y= &quot;Nombre de cas par million&quot;
  )</code></pre>
<p><img src="/post/2020-08-24-covid_cs_files/figure-html/unnamed-chunk-11-1.png" width="1152" style="display: block; margin: auto;" /></p>
